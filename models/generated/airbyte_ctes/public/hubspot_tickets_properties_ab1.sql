{{ config(schema="_airbyte_public", tags=["nested-intermediate"]) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
select
    _airbyte_hubspot_tickets_hashid,
    {{ json_extract_scalar('properties', ['tags']) }} as tags,
    {{ json_extract_scalar('properties', ['content']) }} as {{ adapter.quote('content') }},
    {{ json_extract_scalar('properties', ['subject']) }} as subject,
    {{ json_extract_scalar('properties', ['nps_score']) }} as nps_score,
    {{ json_extract_scalar('properties', ['num_notes']) }} as num_notes,
    {{ json_extract_scalar('properties', ['created_by']) }} as created_by,
    {{ json_extract('properties', ['createdate']) }} as createdate,
    {{ json_extract_scalar('properties', ['source_ref']) }} as source_ref,
    {{ json_extract('properties', ['closed_date']) }} as closed_date,
    {{ json_extract_scalar('properties', ['hs_pipeline']) }} as hs_pipeline,
    {{ json_extract_scalar('properties', ['source_type']) }} as source_type,
    {{ json_extract_scalar('properties', ['hs_object_id']) }} as hs_object_id,
    {{ json_extract_scalar('properties', ['hs_ticket_id']) }} as hs_ticket_id,
    {{ json_extract_scalar('properties', ['hs_time_in_1']) }} as hs_time_in_1,
    {{ json_extract_scalar('properties', ['hs_time_in_2']) }} as hs_time_in_2,
    {{ json_extract_scalar('properties', ['hs_time_in_3']) }} as hs_time_in_3,
    {{ json_extract_scalar('properties', ['hs_time_in_4']) }} as hs_time_in_4,
    {{ json_extract('properties', ['hs_createdate']) }} as hs_createdate,
    {{ json_extract_scalar('properties', ['hs_resolution']) }} as hs_resolution,
    {{ json_extract_scalar('properties', ['time_to_close']) }} as time_to_close,
    {{ json_extract_scalar('properties', ['hs_file_upload']) }} as hs_file_upload,
    {{ json_extract_scalar('properties', ['hs_all_team_ids']) }} as hs_all_team_ids,
    {{ json_extract_scalar('properties', ['hs_custom_inbox']) }} as hs_custom_inbox,
    {{ json_extract_scalar('properties', ['hubspot_team_id']) }} as hubspot_team_id,
    {{ json_extract('properties', ['last_reply_date']) }} as last_reply_date,
    {{ json_extract_scalar('properties', ['hs_all_owner_ids']) }} as hs_all_owner_ids,
    {{ json_extract('properties', ['hs_date_exited_1']) }} as hs_date_exited_1,
    {{ json_extract('properties', ['hs_date_exited_2']) }} as hs_date_exited_2,
    {{ json_extract('properties', ['hs_date_exited_3']) }} as hs_date_exited_3,
    {{ json_extract('properties', ['hs_date_exited_4']) }} as hs_date_exited_4,
    {{ json_extract('properties', ['hs_lastcontacted']) }} as hs_lastcontacted,
    {{ json_extract_scalar('properties', ['hubspot_owner_id']) }} as hubspot_owner_id,
    {{ json_extract_scalar('properties', ['source_thread_id']) }} as source_thread_id,
    {{ json_extract('properties', ['hs_date_entered_1']) }} as hs_date_entered_1,
    {{ json_extract('properties', ['hs_date_entered_2']) }} as hs_date_entered_2,
    {{ json_extract('properties', ['hs_date_entered_3']) }} as hs_date_entered_3,
    {{ json_extract('properties', ['hs_date_entered_4']) }} as hs_date_entered_4,
    {{ json_extract_scalar('properties', ['hs_pipeline_stage']) }} as hs_pipeline_stage,
    {{ json_extract('properties', ['hs_last_email_date']) }} as hs_last_email_date,
    {{ json_extract_scalar('properties', ['hs_ticket_category']) }} as hs_ticket_category,
    {{ json_extract_scalar('properties', ['hs_ticket_priority']) }} as hs_ticket_priority,
    {{ json_extract('properties', ['notes_last_updated']) }} as notes_last_updated,
    {{ json_extract('properties', ['hs_lastactivitydate']) }} as hs_lastactivitydate,
    {{ json_extract('properties', ['hs_lastmodifieddate']) }} as hs_lastmodifieddate,
    {{ json_extract('properties', ['hs_nextactivitydate']) }} as hs_nextactivitydate,
    {{ json_extract_scalar('properties', ['num_contacted_notes']) }} as num_contacted_notes,
    {{ json_extract_scalar('properties', ['hs_merged_object_ids']) }} as hs_merged_object_ids,
    {{ json_extract('properties', ['last_engagement_date']) }} as last_engagement_date,
    {{ json_extract('properties', ['notes_last_contacted']) }} as notes_last_contacted,
    {{ json_extract_scalar('properties', ['nps_follow_up_answer']) }} as nps_follow_up_answer,
    {{ json_extract_scalar('properties', ['hs_created_by_user_id']) }} as hs_created_by_user_id,
    {{ json_extract_scalar('properties', ['hs_updated_by_user_id']) }} as hs_updated_by_user_id,
    {{ json_extract('properties', ['first_agent_reply_date']) }} as first_agent_reply_date,
    {{ json_extract_scalar('properties', ['hs_external_object_ids']) }} as hs_external_object_ids,
    {{ json_extract_scalar('properties', ['hs_last_email_activity']) }} as hs_last_email_activity,
    {{ json_extract_scalar('properties', ['hs_num_times_contacted']) }} as hs_num_times_contacted,
    {{ json_extract_scalar('properties', ['hs_unique_creation_key']) }} as hs_unique_creation_key,
    {{ json_extract_scalar('properties', ['hs_thread_ids_to_restore']) }} as hs_thread_ids_to_restore,
    {{ json_extract('properties', ['notes_next_activity_date']) }} as notes_next_activity_date,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_owners']) }} as hs_user_ids_of_all_owners,
    {{ json_extract_scalar('properties', ['time_to_first_agent_reply']) }} as time_to_first_agent_reply,
    {{ json_extract_scalar('properties', ['hs_all_accessible_team_ids']) }} as hs_all_accessible_team_ids,
    {{ json_extract('properties', ['hubspot_owner_assigneddate']) }} as hubspot_owner_assigneddate,
    {{ json_extract_scalar('properties', ['hs_num_associated_companies']) }} as hs_num_associated_companies,
    {{ json_extract('properties', ['hs_sales_email_last_replied']) }} as hs_sales_email_last_replied,
    {{ json_extract_scalar('properties', ['nps_follow_up_question_version']) }} as nps_follow_up_question_version,
    {{ json_extract_scalar('properties', ['hs_all_assigned_business_unit_ids']) }} as hs_all_assigned_business_unit_ids,
    {{ json_extract_scalar('properties', ['hs_originating_email_engagement_id']) }} as hs_originating_email_engagement_id,
    {{ json_extract_scalar('properties', ['hs_conversations_originating_thread_id']) }} as hs_conversations_originating_thread_id,
    {{ json_extract_scalar('properties', ['hs_conversations_originating_message_id']) }} as hs_conversations_originating_message_id,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_followers']) }} as hs_user_ids_of_all_notification_followers,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_unfollowers']) }} as hs_user_ids_of_all_notification_unfollowers,
    _airbyte_emitted_at
from {{ ref('hubspot_tickets') }}
where properties is not null
-- properties at hubspot_tickets/properties

