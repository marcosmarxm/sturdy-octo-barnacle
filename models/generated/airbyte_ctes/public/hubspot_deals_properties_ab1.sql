{{ config(schema="_airbyte_public", tags=["nested-intermediate"]) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
select
    _airbyte_hubspot_deals_hashid,
    {{ json_extract_scalar('properties', ['amount']) }} as amount,
    {{ json_extract_scalar('properties', ['hs_acv']) }} as hs_acv,
    {{ json_extract_scalar('properties', ['hs_arr']) }} as hs_arr,
    {{ json_extract_scalar('properties', ['hs_mrr']) }} as hs_mrr,
    {{ json_extract_scalar('properties', ['hs_tcv']) }} as hs_tcv,
    {{ json_extract_scalar('properties', ['dealname']) }} as dealname,
    {{ json_extract_scalar('properties', ['dealtype']) }} as dealtype,
    {{ json_extract_scalar('properties', ['pipeline']) }} as pipeline,
    {{ json_extract('properties', ['closedate']) }} as closedate,
    {{ json_extract_scalar('properties', ['dealstage']) }} as dealstage,
    {{ json_extract_scalar('properties', ['num_notes']) }} as num_notes,
    {{ json_extract('properties', ['createdate']) }} as createdate,
    {{ json_extract_scalar('properties', ['description']) }} as description,
    {{ json_extract_scalar('properties', ['hs_priority']) }} as hs_priority,
    {{ json_extract('properties', ['hs_is_closed']) }} as hs_is_closed,
    {{ json_extract_scalar('properties', ['hs_next_step']) }} as hs_next_step,
    {{ json_extract_scalar('properties', ['hs_object_id']) }} as hs_object_id,
    {{ json_extract_scalar('properties', ['days_to_close']) }} as days_to_close,
    {{ json_extract('properties', ['hs_createdate']) }} as hs_createdate,
    {{ json_extract_scalar('properties', ['hs_all_team_ids']) }} as hs_all_team_ids,
    {{ json_extract_scalar('properties', ['hubspot_team_id']) }} as hubspot_team_id,
    {{ json_extract_scalar('properties', ['hs_all_owner_ids']) }} as hs_all_owner_ids,
    {{ json_extract_scalar('properties', ['hs_closed_amount']) }} as hs_closed_amount,
    {{ json_extract('properties', ['hs_is_closed_won']) }} as hs_is_closed_won,
    {{ json_extract_scalar('properties', ['hubspot_owner_id']) }} as hubspot_owner_id,
    {{ json_extract_scalar('properties', ['closed_won_reason']) }} as closed_won_reason,
    {{ json_extract_scalar('properties', ['closed_lost_reason']) }} as closed_lost_reason,
    {{ json_extract_scalar('properties', ['hs_forecast_amount']) }} as hs_forecast_amount,
    {{ json_extract_scalar('properties', ['hs_time_in_9567448']) }} as hs_time_in_9567448,
    {{ json_extract_scalar('properties', ['hs_time_in_9567449']) }} as hs_time_in_9567449,
    {{ json_extract('properties', ['notes_last_updated']) }} as notes_last_updated,
    {{ json_extract_scalar('properties', ['hs_analytics_source']) }} as hs_analytics_source,
    {{ json_extract('properties', ['hs_lastmodifieddate']) }} as hs_lastmodifieddate,
    {{ json_extract_scalar('properties', ['hs_predicted_amount']) }} as hs_predicted_amount,
    {{ json_extract_scalar('properties', ['hs_projected_amount']) }} as hs_projected_amount,
    {{ json_extract_scalar('properties', ['num_contacted_notes']) }} as num_contacted_notes,
    {{ json_extract_scalar('properties', ['hs_merged_object_ids']) }} as hs_merged_object_ids,
    {{ json_extract_scalar('properties', ['hs_time_in_closedwon']) }} as hs_time_in_closedwon,
    {{ json_extract('properties', ['notes_last_contacted']) }} as notes_last_contacted,
    {{ json_extract_scalar('properties', ['hs_created_by_user_id']) }} as hs_created_by_user_id,
    {{ json_extract_scalar('properties', ['hs_time_in_closedlost']) }} as hs_time_in_closedlost,
    {{ json_extract_scalar('properties', ['hs_updated_by_user_id']) }} as hs_updated_by_user_id,
    {{ json_extract('properties', ['hs_date_exited_9567448']) }} as hs_date_exited_9567448,
    {{ json_extract('properties', ['hs_date_exited_9567449']) }} as hs_date_exited_9567449,
    {{ json_extract_scalar('properties', ['hs_likelihood_to_close']) }} as hs_likelihood_to_close,
    {{ json_extract_scalar('properties', ['hs_num_target_accounts']) }} as hs_num_target_accounts,
    {{ json_extract_scalar('properties', ['hs_unique_creation_key']) }} as hs_unique_creation_key,
    {{ json_extract_scalar('properties', ['amount_in_home_currency']) }} as amount_in_home_currency,
    {{ json_extract('properties', ['hs_date_entered_9567448']) }} as hs_date_entered_9567448,
    {{ json_extract('properties', ['hs_date_entered_9567449']) }} as hs_date_entered_9567449,
    {{ json_extract_scalar('properties', ['hs_forecast_probability']) }} as hs_forecast_probability,
    {{ json_extract_scalar('properties', ['hs_time_in_contractsent']) }} as hs_time_in_contractsent,
    {{ json_extract_scalar('properties', ['num_associated_contacts']) }} as num_associated_contacts,
    {{ json_extract('properties', ['hs_date_exited_closedwon']) }} as hs_date_exited_closedwon,
    {{ json_extract('properties', ['notes_next_activity_date']) }} as notes_next_activity_date,
    {{ json_extract('properties', ['hs_date_entered_closedwon']) }} as hs_date_entered_closedwon,
    {{ json_extract('properties', ['hs_date_exited_closedlost']) }} as hs_date_exited_closedlost,
    {{ json_extract_scalar('properties', ['hs_deal_stage_probability']) }} as hs_deal_stage_probability,
    {{ json_extract_scalar('properties', ['hs_time_in_qualifiedtobuy']) }} as hs_time_in_qualifiedtobuy,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_owners']) }} as hs_user_ids_of_all_owners,
    {{ json_extract_scalar('properties', ['hs_all_accessible_team_ids']) }} as hs_all_accessible_team_ids,
    {{ json_extract_scalar('properties', ['hs_analytics_source_data_1']) }} as hs_analytics_source_data_1,
    {{ json_extract_scalar('properties', ['hs_analytics_source_data_2']) }} as hs_analytics_source_data_2,
    {{ json_extract('properties', ['hs_date_entered_closedlost']) }} as hs_date_entered_closedlost,
    {{ json_extract('properties', ['hs_latest_meeting_activity']) }} as hs_latest_meeting_activity,
    {{ json_extract('properties', ['hubspot_owner_assigneddate']) }} as hubspot_owner_assigneddate,
    {{ json_extract('properties', ['hs_date_exited_contractsent']) }} as hs_date_exited_contractsent,
    {{ json_extract_scalar('properties', ['hs_manual_forecast_category']) }} as hs_manual_forecast_category,
    {{ json_extract('properties', ['hs_sales_email_last_replied']) }} as hs_sales_email_last_replied,
    {{ json_extract('properties', ['hs_date_entered_contractsent']) }} as hs_date_entered_contractsent,
    {{ json_extract('properties', ['hs_date_exited_qualifiedtobuy']) }} as hs_date_exited_qualifiedtobuy,
    {{ json_extract('properties', ['hs_date_entered_qualifiedtobuy']) }} as hs_date_entered_qualifiedtobuy,
    {{ json_extract('properties', ['engagements_last_meeting_booked']) }} as engagements_last_meeting_booked,
    {{ json_extract_scalar('properties', ['hs_time_in_appointmentscheduled']) }} as hs_time_in_appointmentscheduled,
    {{ json_extract_scalar('properties', ['hs_time_in_customclosedwonstage']) }} as hs_time_in_customclosedwonstage,
    {{ json_extract_scalar('properties', ['hs_deal_stage_probability_shadow']) }} as hs_deal_stage_probability_shadow,
    {{ json_extract_scalar('properties', ['hs_time_in_decisionmakerboughtin']) }} as hs_time_in_decisionmakerboughtin,
    {{ json_extract_scalar('properties', ['hs_time_in_presentationscheduled']) }} as hs_time_in_presentationscheduled,
    {{ json_extract_scalar('properties', ['hs_all_assigned_business_unit_ids']) }} as hs_all_assigned_business_unit_ids,
    {{ json_extract_scalar('properties', ['hs_closed_amount_in_home_currency']) }} as hs_closed_amount_in_home_currency,
    {{ json_extract('properties', ['hs_date_exited_appointmentscheduled']) }} as hs_date_exited_appointmentscheduled,
    {{ json_extract('properties', ['hs_date_exited_customclosedwonstage']) }} as hs_date_exited_customclosedwonstage,
    {{ json_extract('properties', ['hs_date_entered_appointmentscheduled']) }} as hs_date_entered_appointmentscheduled,
    {{ json_extract('properties', ['hs_date_entered_customclosedwonstage']) }} as hs_date_entered_customclosedwonstage,
    {{ json_extract('properties', ['hs_date_exited_decisionmakerboughtin']) }} as hs_date_exited_decisionmakerboughtin,
    {{ json_extract('properties', ['hs_date_exited_presentationscheduled']) }} as hs_date_exited_presentationscheduled,
    {{ json_extract_scalar('properties', ['hs_predicted_amount_in_home_currency']) }} as hs_predicted_amount_in_home_currency,
    {{ json_extract_scalar('properties', ['hs_projected_amount_in_home_currency']) }} as hs_projected_amount_in_home_currency,
    {{ json_extract('properties', ['hs_date_entered_decisionmakerboughtin']) }} as hs_date_entered_decisionmakerboughtin,
    {{ json_extract('properties', ['hs_date_entered_presentationscheduled']) }} as hs_date_entered_presentationscheduled,
    {{ json_extract_scalar('properties', ['hs_deal_amount_calculation_preference']) }} as hs_deal_amount_calculation_preference,
    {{ json_extract_scalar('properties', ['engagements_last_meeting_booked_medium']) }} as engagements_last_meeting_booked_medium,
    {{ json_extract_scalar('properties', ['engagements_last_meeting_booked_source']) }} as engagements_last_meeting_booked_source,
    {{ json_extract_scalar('properties', ['engagements_last_meeting_booked_campaign']) }} as engagements_last_meeting_booked_campaign,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_followers']) }} as hs_user_ids_of_all_notification_followers,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_unfollowers']) }} as hs_user_ids_of_all_notification_unfollowers,
    {{ json_extract_scalar('properties', ['hs_line_item_global_term_hs_discount_percentage']) }} as hs_line_item_global___s_discount_percentage,
    {{ json_extract_scalar('properties', ['hs_line_item_global_term_recurringbillingfrequency']) }} as hs_line_item_global___rringbillingfrequency,
    {{ json_extract_scalar('properties', ['hs_line_item_global_term_hs_recurring_billing_period']) }} as hs_line_item_global___urring_billing_period,
    {{ json_extract('properties', ['hs_line_item_global_term_hs_discount_percentage_enabled']) }} as hs_line_item_global___nt_percentage_enabled,
    {{ json_extract_scalar('properties', ['hs_line_item_global_term_hs_recurring_billing_start_date']) }} as hs_line_item_global___ng_billing_start_date,
    {{ json_extract('properties', ['hs_line_item_global_term_recurringbillingfrequency_enabled']) }} as hs_line_item_global___lingfrequency_enabled,
    {{ json_extract('properties', ['hs_line_item_global_term_hs_recurring_billing_period_enabled']) }} as hs_line_item_global___illing_period_enabled,
    {{ json_extract('properties', ['hs_line_item_global_term_hs_recurring_billing_start_date_enabled']) }} as hs_line_item_global___ng_start_date_enabled,
    _airbyte_emitted_at
from {{ ref('hubspot_deals') }}
where properties is not null
-- properties at hubspot_deals/properties

