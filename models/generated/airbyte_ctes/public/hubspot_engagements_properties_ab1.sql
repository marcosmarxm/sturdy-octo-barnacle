{{ config(schema="_airbyte_public", tags=["nested-intermediate"]) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
select
    _airbyte_hubspot_engagements_hashid,
    {{ json_extract_scalar('properties', ['hs_call_body']) }} as hs_call_body,
    {{ json_extract_scalar('properties', ['hs_i_cal_uid']) }} as hs_i_cal_uid,
    {{ json_extract_scalar('properties', ['hs_note_body']) }} as hs_note_body,
    {{ json_extract_scalar('properties', ['hs_object_id']) }} as hs_object_id,
    {{ json_extract_scalar('properties', ['hs_task_body']) }} as hs_task_body,
    {{ json_extract_scalar('properties', ['hs_task_type']) }} as hs_task_type,
    {{ json_extract('properties', ['hs_timestamp']) }} as hs_timestamp,
    {{ json_extract_scalar('properties', ['hs_unique_id']) }} as hs_unique_id,
    {{ json_extract_scalar('properties', ['hs_call_title']) }} as hs_call_title,
    {{ json_extract_scalar('properties', ['hs_created_by']) }} as hs_created_by,
    {{ json_extract('properties', ['hs_createdate']) }} as hs_createdate,
    {{ json_extract_scalar('properties', ['hs_email_html']) }} as hs_email_html,
    {{ json_extract_scalar('properties', ['hs_email_text']) }} as hs_email_text,
    {{ json_extract_scalar('properties', ['hs_call_app_id']) }} as hs_call_app_id,
    {{ json_extract_scalar('properties', ['hs_call_source']) }} as hs_call_source,
    {{ json_extract_scalar('properties', ['hs_call_status']) }} as hs_call_status,
    {{ json_extract_scalar('properties', ['hs_modified_by']) }} as hs_modified_by,
    {{ json_extract_scalar('properties', ['hs_task_status']) }} as hs_task_status,
    {{ json_extract_scalar('properties', ['hs_all_team_ids']) }} as hs_all_team_ids,
    {{ json_extract_scalar('properties', ['hs_body_preview']) }} as hs_body_preview,
    {{ json_extract_scalar('properties', ['hs_email_cc_raw']) }} as hs_email_cc_raw,
    {{ json_extract_scalar('properties', ['hs_email_status']) }} as hs_email_status,
    {{ json_extract_scalar('properties', ['hs_email_to_raw']) }} as hs_email_to_raw,
    {{ json_extract('properties', ['hs_gdpr_deleted']) }} as hs_gdpr_deleted,
    {{ json_extract_scalar('properties', ['hs_meeting_body']) }} as hs_meeting_body,
    {{ json_extract_scalar('properties', ['hs_product_name']) }} as hs_product_name,
    {{ json_extract_scalar('properties', ['hs_task_subject']) }} as hs_task_subject,
    {{ json_extract_scalar('properties', ['hubspot_team_id']) }} as hubspot_team_id,
    {{ json_extract_scalar('properties', ['hs_activity_type']) }} as hs_activity_type,
    {{ json_extract_scalar('properties', ['hs_all_owner_ids']) }} as hs_all_owner_ids,
    {{ json_extract_scalar('properties', ['hs_call_duration']) }} as hs_call_duration,
    {{ json_extract_scalar('properties', ['hs_email_bcc_raw']) }} as hs_email_bcc_raw,
    {{ json_extract('properties', ['hs_email_headers']) }} as hs_email_headers,
    {{ json_extract_scalar('properties', ['hs_email_subject']) }} as hs_email_subject,
    {{ json_extract_scalar('properties', ['hs_meeting_title']) }} as hs_meeting_title,
    {{ json_extract_scalar('properties', ['hs_task_priority']) }} as hs_task_priority,
    {{ json_extract_scalar('properties', ['hubspot_owner_id']) }} as hubspot_owner_id,
    {{ json_extract_scalar('properties', ['hs_attachment_ids']) }} as hs_attachment_ids,
    {{ json_extract_scalar('properties', ['hs_call_to_number']) }} as hs_call_to_number,
    {{ json_extract_scalar('properties', ['hs_email_cc_email']) }} as hs_email_cc_email,
    {{ json_extract_scalar('properties', ['hs_email_from_raw']) }} as hs_email_from_raw,
    {{ json_extract_scalar('properties', ['hs_email_sent_via']) }} as hs_email_sent_via,
    {{ json_extract_scalar('properties', ['hs_email_to_email']) }} as hs_email_to_email,
    {{ json_extract_scalar('properties', ['hs_meeting_source']) }} as hs_meeting_source,
    {{ json_extract_scalar('properties', ['hs_task_reminders']) }} as hs_task_reminders,
    {{ json_extract_scalar('properties', ['hs_email_bcc_email']) }} as hs_email_bcc_email,
    {{ json_extract_scalar('properties', ['hs_email_direction']) }} as hs_email_direction,
    {{ json_extract_scalar('properties', ['hs_email_thread_id']) }} as hs_email_thread_id,
    {{ json_extract_scalar('properties', ['hs_engagement_type']) }} as hs_engagement_type,
    {{ json_extract_scalar('properties', ['hs_meeting_outcome']) }} as hs_meeting_outcome,
    {{ json_extract('properties', ['hs_scheduled_tasks']) }} as hs_scheduled_tasks,
    {{ json_extract('properties', ['hs_task_is_all_day']) }} as hs_task_is_all_day,
    {{ json_extract_scalar('properties', ['hs_call_disposition']) }} as hs_call_disposition,
    {{ json_extract_scalar('properties', ['hs_call_external_id']) }} as hs_call_external_id,
    {{ json_extract_scalar('properties', ['hs_call_from_number']) }} as hs_call_from_number,
    {{ json_extract_scalar('properties', ['hs_email_from_email']) }} as hs_email_from_email,
    {{ json_extract_scalar('properties', ['hs_email_message_id']) }} as hs_email_message_id,
    {{ json_extract_scalar('properties', ['hs_email_sender_raw']) }} as hs_email_sender_raw,
    {{ json_extract_scalar('properties', ['hs_follow_up_action']) }} as hs_follow_up_action,
    {{ json_extract('properties', ['hs_lastmodifieddate']) }} as hs_lastmodifieddate,
    {{ json_extract('properties', ['hs_meeting_end_time']) }} as hs_meeting_end_time,
    {{ json_extract_scalar('properties', ['hs_meeting_location']) }} as hs_meeting_location,
    {{ json_extract_scalar('properties', ['hs_task_template_id']) }} as hs_task_template_id,
    {{ json_extract_scalar('properties', ['hs_body_preview_html']) }} as hs_body_preview_html,
    {{ json_extract_scalar('properties', ['hs_calendar_event_id']) }} as hs_calendar_event_id,
    {{ json_extract_scalar('properties', ['hs_email_cc_lastname']) }} as hs_email_cc_lastname,
    {{ json_extract_scalar('properties', ['hs_email_logged_from']) }} as hs_email_logged_from,
    {{ json_extract_scalar('properties', ['hs_email_to_lastname']) }} as hs_email_to_lastname,
    {{ json_extract_scalar('properties', ['hs_email_tracker_key']) }} as hs_email_tracker_key,
    {{ json_extract_scalar('properties', ['hs_engagement_source']) }} as hs_engagement_source,
    {{ json_extract_scalar('properties', ['hs_meeting_source_id']) }} as hs_meeting_source_id,
    {{ json_extract_scalar('properties', ['hs_merged_object_ids']) }} as hs_merged_object_ids,
    {{ json_extract_scalar('properties', ['hs_call_recording_url']) }} as hs_call_recording_url,
    {{ json_extract_scalar('properties', ['hs_created_by_user_id']) }} as hs_created_by_user_id,
    {{ json_extract_scalar('properties', ['hs_email_bcc_lastname']) }} as hs_email_bcc_lastname,
    {{ json_extract_scalar('properties', ['hs_email_cc_firstname']) }} as hs_email_cc_firstname,
    {{ json_extract_scalar('properties', ['hs_email_sender_email']) }} as hs_email_sender_email,
    {{ json_extract_scalar('properties', ['hs_email_to_firstname']) }} as hs_email_to_firstname,
    {{ json_extract('properties', ['hs_meeting_start_time']) }} as hs_meeting_start_time,
    {{ json_extract_scalar('properties', ['hs_updated_by_user_id']) }} as hs_updated_by_user_id,
    {{ json_extract('properties', ['hs_call_has_transcript']) }} as hs_call_has_transcript,
    {{ json_extract_scalar('properties', ['hs_email_bcc_firstname']) }} as hs_email_bcc_firstname,
    {{ json_extract_scalar('properties', ['hs_email_error_message']) }} as hs_email_error_message,
    {{ json_extract_scalar('properties', ['hs_email_from_lastname']) }} as hs_email_from_lastname,
    {{ json_extract_scalar('properties', ['hs_email_send_event_id']) }} as hs_email_send_event_id,
    {{ json_extract_scalar('properties', ['hs_unique_creation_key']) }} as hs_unique_creation_key,
    {{ json_extract_scalar('properties', ['hs_email_from_firstname']) }} as hs_email_from_firstname,
    {{ json_extract_scalar('properties', ['hs_engagement_source_id']) }} as hs_engagement_source_id,
    {{ json_extract_scalar('properties', ['hs_meeting_external_url']) }} as hs_meeting_external_url,
    {{ json_extract_scalar('properties', ['hs_num_associated_deals']) }} as hs_num_associated_deals,
    {{ json_extract_scalar('properties', ['hs_publishing_task_body']) }} as hs_publishing_task_body,
    {{ json_extract_scalar('properties', ['hs_publishing_task_name']) }} as hs_publishing_task_name,
    {{ json_extract_scalar('properties', ['hs_queue_membership_ids']) }} as hs_queue_membership_ids,
    {{ json_extract('properties', ['hs_task_completion_date']) }} as hs_task_completion_date,
    {{ json_extract_scalar('properties', ['hs_task_for_object_type']) }} as hs_task_for_object_type,
    {{ json_extract_scalar('properties', ['hs_task_repeat_interval']) }} as hs_task_repeat_interval,
    {{ json_extract_scalar('properties', ['hs_call_callee_object_id']) }} as hs_call_callee_object_id,
    {{ json_extract_scalar('properties', ['hs_call_transcription_id']) }} as hs_call_transcription_id,
    {{ json_extract_scalar('properties', ['hs_calls_service_call_id']) }} as hs_calls_service_call_id,
    {{ json_extract_scalar('properties', ['hs_email_sender_lastname']) }} as hs_email_sender_lastname,
    {{ json_extract_scalar('properties', ['hs_publishing_task_state']) }} as hs_publishing_task_state,
    {{ json_extract_scalar('properties', ['hs_at_mentioned_owner_ids']) }} as hs_at_mentioned_owner_ids,
    {{ json_extract_scalar('properties', ['hs_call_zoom_meeting_uuid']) }} as hs_call_zoom_meeting_uuid,
    {{ json_extract_scalar('properties', ['hs_email_post_send_status']) }} as hs_email_post_send_status,
    {{ json_extract_scalar('properties', ['hs_email_sender_firstname']) }} as hs_email_sender_firstname,
    {{ json_extract_scalar('properties', ['hs_internal_meeting_notes']) }} as hs_internal_meeting_notes,
    {{ json_extract_scalar('properties', ['hs_num_associated_tickets']) }} as hs_num_associated_tickets,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_owners']) }} as hs_user_ids_of_all_owners,
    {{ json_extract_scalar('properties', ['hs_all_accessible_team_ids']) }} as hs_all_accessible_team_ids,
    {{ json_extract_scalar('properties', ['hs_call_callee_object_type']) }} as hs_call_callee_object_type,
    {{ json_extract_scalar('properties', ['hs_direction_and_unique_id']) }} as hs_direction_and_unique_id,
    {{ json_extract_scalar('properties', ['hs_email_facsimile_send_id']) }} as hs_email_facsimile_send_id,
    {{ json_extract_scalar('properties', ['hs_num_associated_contacts']) }} as hs_num_associated_contacts,
    {{ json_extract_scalar('properties', ['hs_task_relative_reminders']) }} as hs_task_relative_reminders,
    {{ json_extract('properties', ['hubspot_owner_assigneddate']) }} as hubspot_owner_assigneddate,
    {{ json_extract_scalar('properties', ['hs_call_authed_url_provider']) }} as hs_call_authed_url_provider,
    {{ json_extract_scalar('properties', ['hs_call_external_account_id']) }} as hs_call_external_account_id,
    {{ json_extract_scalar('properties', ['hs_call_video_recording_url']) }} as hs_call_video_recording_url,
    {{ json_extract_scalar('properties', ['hs_conversation_session_url']) }} as hs_conversation_session_url,
    {{ json_extract_scalar('properties', ['hs_email_validation_skipped']) }} as hs_email_validation_skipped,
    {{ json_extract_scalar('properties', ['hs_num_associated_companies']) }} as hs_num_associated_companies,
    {{ json_extract_scalar('properties', ['hs_publishing_task_category']) }} as hs_publishing_task_category,
    {{ json_extract_scalar('properties', ['hs_task_sequence_step_order']) }} as hs_task_sequence_step_order,
    {{ json_extract('properties', ['hs_body_preview_is_truncated']) }} as hs_body_preview_is_truncated,
    {{ json_extract_scalar('properties', ['hs_publishing_task_content_id']) }} as hs_publishing_task_content_id,
    {{ json_extract('properties', ['hs_task_last_contact_outreach']) }} as hs_task_last_contact_outreach,
    {{ json_extract('properties', ['hs_task_send_default_reminder']) }} as hs_task_send_default_reminder,
    {{ json_extract('properties', ['hs_conversation_session_is_bot']) }} as hs_conversation_session_is_bot,
    {{ json_extract('properties', ['hs_conversation_session_online']) }} as hs_conversation_session_online,
    {{ json_extract_scalar('properties', ['hs_conversation_session_source']) }} as hs_conversation_session_source,
    {{ json_extract('properties', ['hs_email_send_event_id_created']) }} as hs_email_send_event_id_created,
    {{ json_extract_scalar('properties', ['hs_publishing_task_category_id']) }} as hs_publishing_task_category_id,
    {{ json_extract('properties', ['hs_email_recipient_drop_reasons']) }} as hs_email_recipient_drop_reasons,
    {{ json_extract_scalar('properties', ['hs_meeting_created_from_link_id']) }} as hs_meeting_created_from_link_id,
    {{ json_extract_scalar('properties', ['hs_num_associated_queue_objects']) }} as hs_num_associated_queue_objects,
    {{ json_extract_scalar('properties', ['hs_task_probability_to_complete']) }} as hs_task_probability_to_complete,
    {{ json_extract('properties', ['hs_unknown_visitor_conversation']) }} as hs_unknown_visitor_conversation,
    {{ json_extract_scalar('properties', ['hs_conversation_session_duration']) }} as hs_conversation_session_duration,
    {{ json_extract_scalar('properties', ['hs_email_media_processing_status']) }} as hs_email_media_processing_status,
    {{ json_extract_scalar('properties', ['hs_publishing_task_campaign_guid']) }} as hs_publishing_task_campaign_guid,
    {{ json_extract_scalar('properties', ['hs_all_assigned_business_unit_ids']) }} as hs_all_assigned_business_unit_ids,
    {{ json_extract_scalar('properties', ['hs_conversation_session_thread_id']) }} as hs_conversation_session_thread_id,
    {{ json_extract_scalar('properties', ['hs_email_pending_inline_image_ids']) }} as hs_email_pending_inline_image_ids,
    {{ json_extract('properties', ['hs_task_sequence_enrollment_active']) }} as hs_task_sequence_enrollment_active,
    {{ json_extract_scalar('properties', ['hs_publishing_task_campaign_step_id']) }} as hs_publishing_task_campaign_step_id,
    {{ json_extract_scalar('properties', ['hs_task_sequence_step_enrollment_id']) }} as hs_task_sequence_step_enrollment_id,
    {{ json_extract_scalar('properties', ['hs_meeting_web_conference_meeting_id']) }} as hs_meeting_web_conference_meeting_id,
    {{ json_extract('properties', ['hs_task_last_sales_activity_timestamp']) }} as hs_task_last_sales_activity_timestamp,
    {{ json_extract('properties', ['hs_email_member_of_forwarded_subthread']) }} as hs_email_member_of_forwarded_subthread,
    {{ json_extract('properties', ['hs_conversation_session_agent_join_time']) }} as hs_conversation_session_agent_join_time,
    {{ json_extract('properties', ['hs_conversation_session_visitor_end_time']) }} as hs_conversation_session_visitor_end_time,
    {{ json_extract('properties', ['hs_conversation_session_session_closed_at']) }} as hs_conversation_session_session_closed_at,
    {{ json_extract_scalar('properties', ['hs_conversation_session_visitor_wait_time']) }} as hs_conversation_session_visitor_wait_time,
    {{ json_extract_scalar('properties', ['hs_meeting_pre_meeting_prospect_reminders']) }} as hs_meeting_pre_meeting_prospect_reminders,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_followers']) }} as hs_user_ids_of_all_notification_followers,
    {{ json_extract_scalar('properties', ['hs_conversation_session_num_agent_messages']) }} as hs_conversation_session_num_agent_messages,
    {{ json_extract('properties', ['hs_conversation_session_visitor_start_time']) }} as hs_conversation_session_visitor_start_time,
    {{ json_extract_scalar('properties', ['hs_conversation_session_agent_response_time']) }} as hs_conversation_session_agent_response_time,
    {{ json_extract_scalar('properties', ['hs_email_encoded_email_associations_request']) }} as hs_email_encoded_email_associations_request,
    {{ json_extract_scalar('properties', ['hs_email_migrated_via_portal_data_migration']) }} as hs_email_migrated_via_portal_data_migration,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_unfollowers']) }} as hs_user_ids_of_all_notification_unfollowers,
    {{ json_extract_scalar('properties', ['hs_conversation_session_num_visitor_messages']) }} as hs_conversation_sess___num_visitor_messages,
    _airbyte_emitted_at
from {{ ref('hubspot_engagements') }}
where properties is not null
-- properties at hubspot_engagements/properties

