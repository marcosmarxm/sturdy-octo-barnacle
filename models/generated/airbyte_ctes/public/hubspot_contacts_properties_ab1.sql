{{ config(schema="_airbyte_public", tags=["nested-intermediate"]) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
select
    _airbyte_hubspot_contacts_hashid,
    {{ json_extract_scalar('properties', ['fax']) }} as fax,
    {{ json_extract_scalar('properties', ['zip']) }} as zip,
    {{ json_extract_scalar('properties', ['city']) }} as city,
    {{ json_extract_scalar('properties', ['email']) }} as email,
    {{ json_extract_scalar('properties', ['phone']) }} as phone,
    {{ json_extract_scalar('properties', ['state']) }} as {{ adapter.quote('state') }},
    {{ json_extract_scalar('properties', ['degree']) }} as {{ adapter.quote('degree') }},
    {{ json_extract_scalar('properties', ['gender']) }} as gender,
    {{ json_extract_scalar('properties', ['school']) }} as school,
    {{ json_extract_scalar('properties', ['address']) }} as address,
    {{ json_extract_scalar('properties', ['company']) }} as company,
    {{ json_extract_scalar('properties', ['country']) }} as country,
    {{ json_extract_scalar('properties', ['ip_city']) }} as ip_city,
    {{ json_extract_scalar('properties', ['message']) }} as message,
    {{ json_extract_scalar('properties', ['website']) }} as website,
    {{ json_extract_scalar('properties', ['industry']) }} as industry,
    {{ json_extract_scalar('properties', ['ip_state']) }} as ip_state,
    {{ json_extract_scalar('properties', ['jobtitle']) }} as jobtitle,
    {{ json_extract_scalar('properties', ['lastname']) }} as lastname,
    {{ json_extract('properties', ['closedate']) }} as closedate,
    {{ json_extract_scalar('properties', ['firstname']) }} as firstname,
    {{ json_extract_scalar('properties', ['ip_latlon']) }} as ip_latlon,
    {{ json_extract_scalar('properties', ['num_notes']) }} as num_notes,
    {{ json_extract_scalar('properties', ['seniority']) }} as seniority,
    {{ json_extract('properties', ['createdate']) }} as createdate,
    {{ json_extract_scalar('properties', ['hs_persona']) }} as hs_persona,
    {{ json_extract_scalar('properties', ['ip_country']) }} as ip_country,
    {{ json_extract_scalar('properties', ['ip_zipcode']) }} as ip_zipcode,
    {{ json_extract_scalar('properties', ['salutation']) }} as salutation,
    {{ json_extract_scalar('properties', ['start_date']) }} as start_date,
    {{ json_extract_scalar('properties', ['work_email']) }} as work_email,
    {{ json_extract_scalar('properties', ['hs_language']) }} as hs_language,
    {{ json_extract_scalar('properties', ['mobilephone']) }} as mobilephone,
    {{ json_extract_scalar('properties', ['company_size']) }} as company_size,
    {{ json_extract_scalar('properties', ['hs_object_id']) }} as hs_object_id,
    {{ json_extract_scalar('properties', ['hs_testpurge']) }} as hs_testpurge,
    {{ json_extract_scalar('properties', ['hubspotscore']) }} as hubspotscore,
    {{ json_extract_scalar('properties', ['job_function']) }} as job_function,
    {{ json_extract_scalar('properties', ['numemployees']) }} as numemployees,
    {{ json_extract_scalar('properties', ['annualrevenue']) }} as annualrevenue,
    {{ json_extract_scalar('properties', ['date_of_birth']) }} as date_of_birth,
    {{ json_extract_scalar('properties', ['days_to_close']) }} as days_to_close,
    {{ json_extract('properties', ['hs_createdate']) }} as hs_createdate,
    {{ json_extract_scalar('properties', ['hs_email_open']) }} as hs_email_open,
    {{ json_extract('properties', ['hs_is_contact']) }} as hs_is_contact,
    {{ json_extract_scalar('properties', ['ip_state_code']) }} as ip_state_code,
    {{ json_extract_scalar('properties', ['total_revenue']) }} as total_revenue,
    {{ json_extract_scalar('properties', ['twitterhandle']) }} as twitterhandle,
    {{ json_extract_scalar('properties', ['field_of_study']) }} as field_of_study,
    {{ json_extract_scalar('properties', ['hs_buying_role']) }} as hs_buying_role,
    {{ json_extract_scalar('properties', ['hs_email_click']) }} as hs_email_click,
    {{ json_extract_scalar('properties', ['hs_ip_timezone']) }} as hs_ip_timezone,
    {{ json_extract('properties', ['hs_is_unworked']) }} as hs_is_unworked,
    {{ json_extract_scalar('properties', ['hs_lead_status']) }} as hs_lead_status,
    {{ json_extract_scalar('properties', ['hs_legal_basis']) }} as hs_legal_basis,
    {{ json_extract_scalar('properties', ['lifecyclestage']) }} as lifecyclestage,
    {{ json_extract_scalar('properties', ['marital_status']) }} as marital_status,
    {{ json_extract_scalar('properties', ['graduation_date']) }} as graduation_date,
    {{ json_extract_scalar('properties', ['hs_all_team_ids']) }} as hs_all_team_ids,
    {{ json_extract_scalar('properties', ['hs_email_bounce']) }} as hs_email_bounce,
    {{ json_extract_scalar('properties', ['hs_email_domain']) }} as hs_email_domain,
    {{ json_extract('properties', ['hs_email_optout']) }} as hs_email_optout,
    {{ json_extract_scalar('properties', ['hs_testrollback']) }} as hs_testrollback,
    {{ json_extract_scalar('properties', ['hubspot_team_id']) }} as hubspot_team_id,
    {{ json_extract_scalar('properties', ['ip_country_code']) }} as ip_country_code,
    {{ json_extract_scalar('properties', ['military_status']) }} as military_status,
    {{ json_extract_scalar('properties', ['hs_all_owner_ids']) }} as hs_all_owner_ids,
    {{ json_extract_scalar('properties', ['hs_email_replied']) }} as hs_email_replied,
    {{ json_extract_scalar('properties', ['hubspot_owner_id']) }} as hubspot_owner_id,
    {{ json_extract('properties', ['lastmodifieddate']) }} as lastmodifieddate,
    {{ json_extract_scalar('properties', ['hs_count_is_worked']) }} as hs_count_is_worked,
    {{ json_extract_scalar('properties', ['hs_email_delivered']) }} as hs_email_delivered,
    {{ json_extract_scalar('properties', ['hs_google_click_id']) }} as hs_google_click_id,
    {{ json_extract('properties', ['notes_last_updated']) }} as notes_last_updated,
    {{ json_extract_scalar('properties', ['recent_deal_amount']) }} as recent_deal_amount,
    {{ json_extract_scalar('properties', ['associatedcompanyid']) }} as associatedcompanyid,
    {{ json_extract_scalar('properties', ['hs_all_contact_vids']) }} as hs_all_contact_vids,
    {{ json_extract_scalar('properties', ['hs_analytics_source']) }} as hs_analytics_source,
    {{ json_extract('properties', ['hs_lastmodifieddate']) }} as hs_lastmodifieddate,
    {{ json_extract_scalar('properties', ['num_contacted_notes']) }} as num_contacted_notes,
    {{ json_extract_scalar('properties', ['relationship_status']) }} as relationship_status,
    {{ json_extract_scalar('properties', ['hs_additional_emails']) }} as hs_additional_emails,
    {{ json_extract_scalar('properties', ['hs_analytics_revenue']) }} as hs_analytics_revenue,
    {{ json_extract_scalar('properties', ['hs_count_is_unworked']) }} as hs_count_is_unworked,
    {{ json_extract('properties', ['hs_email_bad_address']) }} as hs_email_bad_address,
    {{ json_extract('properties', ['hs_email_quarantined']) }} as hs_email_quarantined,
    {{ json_extract_scalar('properties', ['hs_facebook_click_id']) }} as hs_facebook_click_id,
    {{ json_extract_scalar('properties', ['hs_merged_object_ids']) }} as hs_merged_object_ids,
    {{ json_extract('properties', ['notes_last_contacted']) }} as notes_last_contacted,
    {{ json_extract_scalar('properties', ['num_associated_deals']) }} as num_associated_deals,
    {{ json_extract('properties', ['first_conversion_date']) }} as first_conversion_date,
    {{ json_extract_scalar('properties', ['hs_analytics_last_url']) }} as hs_analytics_last_url,
    {{ json_extract_scalar('properties', ['hs_created_by_user_id']) }} as hs_created_by_user_id,
    {{ json_extract_scalar('properties', ['hs_updated_by_user_id']) }} as hs_updated_by_user_id,
    {{ json_extract_scalar('properties', ['num_conversion_events']) }} as num_conversion_events,
    {{ json_extract_scalar('properties', ['hs_analytics_first_url']) }} as hs_analytics_first_url,
    {{ json_extract('properties', ['hs_email_is_ineligible']) }} as hs_email_is_ineligible,
    {{ json_extract('properties', ['hs_facebook_ad_clicked']) }} as hs_facebook_ad_clicked,
    {{ json_extract_scalar('properties', ['hs_unique_creation_key']) }} as hs_unique_creation_key,
    {{ json_extract('properties', ['recent_conversion_date']) }} as recent_conversion_date,
    {{ json_extract('properties', ['recent_deal_close_date']) }} as recent_deal_close_date,
    {{ json_extract('properties', ['first_deal_created_date']) }} as first_deal_created_date,
    {{ json_extract_scalar('properties', ['hs_analytics_num_visits']) }} as hs_analytics_num_visits,
    {{ json_extract('properties', ['hs_email_last_open_date']) }} as hs_email_last_open_date,
    {{ json_extract('properties', ['hs_email_last_send_date']) }} as hs_email_last_send_date,
    {{ json_extract_scalar('properties', ['webinareventlastupdated']) }} as webinareventlastupdated,
    {{ json_extract('properties', ['hs_email_first_open_date']) }} as hs_email_first_open_date,
    {{ json_extract('properties', ['hs_email_first_send_date']) }} as hs_email_first_send_date,
    {{ json_extract('properties', ['hs_email_last_click_date']) }} as hs_email_last_click_date,
    {{ json_extract_scalar('properties', ['hs_email_last_email_name']) }} as hs_email_last_email_name,
    {{ json_extract('properties', ['hs_email_last_reply_date']) }} as hs_email_last_reply_date,
    {{ json_extract_scalar('properties', ['hs_email_optout_10798197']) }} as hs_email_optout_10798197,
    {{ json_extract_scalar('properties', ['hs_email_optout_11890603']) }} as hs_email_optout_11890603,
    {{ json_extract_scalar('properties', ['hs_email_optout_11890831']) }} as hs_email_optout_11890831,
    {{ json_extract('properties', ['hs_sequences_is_enrolled']) }} as hs_sequences_is_enrolled,
    {{ json_extract('properties', ['notes_next_activity_date']) }} as notes_next_activity_date,
    {{ json_extract_scalar('properties', ['hs_avatar_filemanager_key']) }} as hs_avatar_filemanager_key,
    {{ json_extract_scalar('properties', ['hs_calculated_merged_vids']) }} as hs_calculated_merged_vids,
    {{ json_extract('properties', ['hs_email_first_click_date']) }} as hs_email_first_click_date,
    {{ json_extract('properties', ['hs_email_first_reply_date']) }} as hs_email_first_reply_date,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_owners']) }} as hs_user_ids_of_all_owners,
    {{ json_extract_scalar('properties', ['hs_all_accessible_team_ids']) }} as hs_all_accessible_team_ids,
    {{ json_extract_scalar('properties', ['hs_analytics_last_referrer']) }} as hs_analytics_last_referrer,
    {{ json_extract_scalar('properties', ['hs_analytics_source_data_1']) }} as hs_analytics_source_data_1,
    {{ json_extract_scalar('properties', ['hs_analytics_source_data_2']) }} as hs_analytics_source_data_2,
    {{ json_extract_scalar('properties', ['hs_calculated_phone_number']) }} as hs_calculated_phone_number,
    {{ json_extract('properties', ['hs_document_last_revisited']) }} as hs_document_last_revisited,
    {{ json_extract_scalar('properties', ['hs_emailconfirmationstatus']) }} as hs_emailconfirmationstatus,
    {{ json_extract('properties', ['hs_latest_meeting_activity']) }} as hs_latest_meeting_activity,
    {{ json_extract('properties', ['hs_sales_email_last_opened']) }} as hs_sales_email_last_opened,
    {{ json_extract('properties', ['hubspot_owner_assigneddate']) }} as hubspot_owner_assigneddate,
    {{ json_extract_scalar('properties', ['first_conversion_event_name']) }} as first_conversion_event_name,
    {{ json_extract_scalar('properties', ['hs_analytics_first_referrer']) }} as hs_analytics_first_referrer,
    {{ json_extract('properties', ['hs_analytics_last_timestamp']) }} as hs_analytics_last_timestamp,
    {{ json_extract_scalar('properties', ['hs_analytics_num_page_views']) }} as hs_analytics_num_page_views,
    {{ json_extract_scalar('properties', ['hs_calculated_mobile_number']) }} as hs_calculated_mobile_number,
    {{ json_extract_scalar('properties', ['hs_content_membership_notes']) }} as hs_content_membership_notes,
    {{ json_extract('properties', ['hs_created_by_conversations']) }} as hs_created_by_conversations,
    {{ json_extract_scalar('properties', ['hs_email_hard_bounce_reason']) }} as hs_email_hard_bounce_reason,
    {{ json_extract_scalar('properties', ['hs_email_quarantined_reason']) }} as hs_email_quarantined_reason,
    {{ json_extract('properties', ['hs_last_sales_activity_date']) }} as hs_last_sales_activity_date,
    {{ json_extract_scalar('properties', ['hs_latest_sequence_enrolled']) }} as hs_latest_sequence_enrolled,
    {{ json_extract('properties', ['hs_lifecyclestage_lead_date']) }} as hs_lifecyclestage_lead_date,
    {{ json_extract('properties', ['hs_sa_first_engagement_date']) }} as hs_sa_first_engagement_date,
    {{ json_extract('properties', ['hs_sales_email_last_clicked']) }} as hs_sales_email_last_clicked,
    {{ json_extract('properties', ['hs_sales_email_last_replied']) }} as hs_sales_email_last_replied,
    {{ json_extract_scalar('properties', ['hs_sequences_enrolled_count']) }} as hs_sequences_enrolled_count,
    {{ json_extract_scalar('properties', ['hs_time_to_first_engagement']) }} as hs_time_to_first_engagement,
    {{ json_extract_scalar('properties', ['associatedcompanylastupdated']) }} as associatedcompanylastupdated,
    {{ json_extract('properties', ['hs_analytics_first_timestamp']) }} as hs_analytics_first_timestamp,
    {{ json_extract_scalar('properties', ['hs_content_membership_status']) }} as hs_content_membership_status,
    {{ json_extract('properties', ['hs_lifecyclestage_other_date']) }} as hs_lifecyclestage_other_date,
    {{ json_extract_scalar('properties', ['hs_sa_first_engagement_descr']) }} as hs_sa_first_engagement_descr,
    {{ json_extract_scalar('properties', ['num_unique_conversion_events']) }} as num_unique_conversion_events,
    {{ json_extract_scalar('properties', ['recent_conversion_event_name']) }} as recent_conversion_event_name,
    {{ json_extract_scalar('properties', ['surveymonkeyeventlastupdated']) }} as surveymonkeyeventlastupdated,
    {{ json_extract_scalar('properties', ['hs_first_engagement_object_id']) }} as hs_first_engagement_object_id,
    {{ json_extract('properties', ['hs_latest_sequence_ended_date']) }} as hs_latest_sequence_ended_date,
    {{ json_extract_scalar('properties', ['hs_calculated_form_submissions']) }} as hs_calculated_form_submissions,
    {{ json_extract_scalar('properties', ['hs_conversations_visitor_email']) }} as hs_conversations_visitor_email,
    {{ json_extract('properties', ['engagements_last_meeting_booked']) }} as engagements_last_meeting_booked,
    {{ json_extract_scalar('properties', ['hs_analytics_average_page_views']) }} as hs_analytics_average_page_views,
    {{ json_extract('properties', ['hs_lifecyclestage_customer_date']) }} as hs_lifecyclestage_customer_date,
    {{ json_extract_scalar('properties', ['hs_email_hard_bounce_reason_enum']) }} as hs_email_hard_bounce_reason_enum,
    {{ json_extract('properties', ['hs_last_sales_activity_timestamp']) }} as hs_last_sales_activity_timestamp,
    {{ json_extract('properties', ['hs_latest_sequence_enrolled_date']) }} as hs_latest_sequence_enrolled_date,
    {{ json_extract('properties', ['hs_latest_sequence_finished_date']) }} as hs_latest_sequence_finished_date,
    {{ json_extract('properties', ['hs_analytics_last_visit_timestamp']) }} as hs_analytics_last_visit_timestamp,
    {{ json_extract('properties', ['hs_lifecyclestage_evangelist_date']) }} as hs_lifecyclestage_evangelist_date,
    {{ json_extract('properties', ['hs_lifecyclestage_subscriber_date']) }} as hs_lifecyclestage_subscriber_date,
    {{ json_extract('properties', ['hs_analytics_first_visit_timestamp']) }} as hs_analytics_first_visit_timestamp,
    {{ json_extract_scalar('properties', ['hs_analytics_num_event_completions']) }} as hs_analytics_num_event_completions,
    {{ json_extract('properties', ['hs_latest_sequence_unenrolled_date']) }} as hs_latest_sequence_unenrolled_date,
    {{ json_extract('properties', ['hs_lifecyclestage_opportunity_date']) }} as hs_lifecyclestage_opportunity_date,
    {{ json_extract_scalar('properties', ['hs_sa_first_engagement_object_type']) }} as hs_sa_first_engagement_object_type,
    {{ json_extract('properties', ['hs_content_membership_registered_at']) }} as hs_content_membership_registered_at,
    {{ json_extract_scalar('properties', ['hs_calculated_phone_number_area_code']) }} as hs_calculated_phone_number_area_code,
    {{ json_extract_scalar('properties', ['hs_email_customer_quarantined_reason']) }} as hs_email_customer_quarantined_reason,
    {{ json_extract_scalar('properties', ['hs_email_sends_since_last_engagement']) }} as hs_email_sends_since_last_engagement,
    {{ json_extract('properties', ['hs_content_membership_email_confirmed']) }} as hs_content_membership_email_confirmed,
    {{ json_extract_scalar('properties', ['hs_searchable_calculated_phone_number']) }} as hs_searchable_calculated_phone_number,
    {{ json_extract_scalar('properties', ['engagements_last_meeting_booked_medium']) }} as engagements_last_meeting_booked_medium,
    {{ json_extract_scalar('properties', ['engagements_last_meeting_booked_source']) }} as engagements_last_meeting_booked_source,
    {{ json_extract_scalar('properties', ['hs_calculated_phone_number_region_code']) }} as hs_calculated_phone_number_region_code,
    {{ json_extract_scalar('properties', ['hs_searchable_calculated_mobile_number']) }} as hs_searchable_calculated_mobile_number,
    {{ json_extract_scalar('properties', ['hs_calculated_phone_number_country_code']) }} as hs_calculated_phone_number_country_code,
    {{ json_extract_scalar('properties', ['engagements_last_meeting_booked_campaign']) }} as engagements_last_meeting_booked_campaign,
    {{ json_extract('properties', ['hs_lifecyclestage_salesqualifiedlead_date']) }} as hs_lifecyclestage_salesqualifiedlead_date,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_followers']) }} as hs_user_ids_of_all_notification_followers,
    {{ json_extract_scalar('properties', ['hs_analytics_last_touch_converting_campaign']) }} as hs_analytics_last_touch_converting_campaign,
    {{ json_extract_scalar('properties', ['hs_user_ids_of_all_notification_unfollowers']) }} as hs_user_ids_of_all_notification_unfollowers,
    {{ json_extract_scalar('properties', ['hs_analytics_first_touch_converting_campaign']) }} as hs_analytics_first_t__h_converting_campaign,
    {{ json_extract('properties', ['hs_lifecyclestage_marketingqualifiedlead_date']) }} as hs_lifecyclestage_ma__ingqualifiedlead_date,
    {{ json_extract('properties', ['hs_content_membership_registration_email_sent_at']) }} as hs_content_membershi__tration_email_sent_at,
    {{ json_extract_scalar('properties', ['hs_content_membership_registration_domain_sent_to']) }} as hs_content_membershi__ration_domain_sent_to,
    {{ json_extract_scalar('properties', ['hs_searchable_calculated_international_phone_number']) }} as hs_searchable_calcul__national_phone_number,
    {{ json_extract_scalar('properties', ['hs_searchable_calculated_international_mobile_number']) }} as hs_searchable_calcul__ational_mobile_number,
    _airbyte_emitted_at
from {{ ref('hubspot_contacts') }}
where properties is not null
-- properties at hubspot_contacts/properties

